{
  "feature_id": "PD-0001",
  "title": "GitHub review by sourcery-ai[bot]",
  "summary": "Hey - I've found 3 issues, and left some high level feedback:\n\n- In `Settings.cors_origins_list`, consider filtering out empty strings after `split(',')` so that accidental trailing commas or an empty `CORS_ORIGINS` value don‚Äôt result in `\"\"` being passed to `CORSMiddleware.allow_origins`.\n- Both configuration and database modules instantiate global objects (`settings`, `async_engine`, `AsyncSessionLocal`) at import time; you might consider a factory or dependency-injected pattern so that startup failures and environment differences (e.g., between local, test, and prod) are easier to control and override.\n\n<details>\n<summary>Prompt for AI Agents</summary>\n\n~~~markdown\nPlease address the comments from this code review:\n\n## Overall Comments\n- In `Settings.cors_origins_list`, consider filtering out empty strings after `split(',')` so that accidental trailing commas or an empty `CORS_ORIGINS` value don‚Äôt result in `\"\"` being passed to `CORSMiddleware.allow_origins`.\n- Both configuration and database modules instantiate global objects (`settings`, `async_engine`, `AsyncSessionLocal`) at import time; you might consider a factory or dependency-injected pattern so that startup failures and environment differences (e.g., between local, test, and prod) are easier to control and override.\n\n## Individual Comments\n\n### Comment 1\n<location path=\"backend/app/config.py\" line_range=\"20-23\" />\n<code_context>\n+    GITHUB_TOKEN: str | None = None\n+    LOG_LEVEL: str = \"INFO\"\n+\n+    @property\n+    def cors_origins_list(self) -> list[str]:\n+        \"\"\"Split comma-separated CORS_ORIGINS into a list.\"\"\"\n+        return [origin.strip() for origin in self.CORS_ORIGINS.split(\",\")]\n+\n+\n</code_context>\n<issue_to_address>\n**suggestion (bug_risk):** Filter out empty CORS origins when building the list.\n\nIf `CORS_ORIGINS` is empty or has trailing commas (e.g. `\"http://a.com,http://b.com,\"`), this will produce empty-string entries, so FastAPI/Starlette will treat `\"\"` as an allowed origin. To avoid that, filter out empty values, e.g. `return [o for o in (origin.strip() for origin in self.CORS_ORIGINS.split(',')) if o]`.\n\n```suggestion\n    @property\n    def cors_origins_list(self) -> list[str]:\n        \"\"\"Split comma-separated CORS_ORIGINS into a list.\"\"\"\n        return [\n            origin\n            for origin in (o.strip() for o in self.CORS_ORIGINS.split(\",\"))\n            if origin\n        ]\n```\n</issue_to_address>\n\n### Comment 2\n<location path=\"backend/tests/unit/test_config.py\" line_range=\"49-60\" />\n<code_context>\n+        with pytest.raises(ValidationError, match=\"JWT_SECRET\"):\n+            Settings()\n+\n+    def test_should_split_origins_when_comma_separated(\n+        self, monkeypatch: pytest.MonkeyPatch\n+    ) -> None:\n+        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n+        monkeypatch.setenv(\"CORS_ORIGINS\", \"http://localhost:3000,http://localhost:3001\")\n+\n+        from app.config import Settings\n+\n+        s = Settings()\n+        assert s.cors_origins_list == [\"http://localhost:3000\", \"http://localhost:3001\"]\n+\n+    def test_should_strip_whitespace_when_cors_origins_have_spaces(\n+        self, monkeypatch: pytest.MonkeyPatch\n+    ) -> None:\n+        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n+        monkeypatch.setenv(\"CORS_ORIGINS\", \"http://a , http://b\")\n+\n+        from app.config import Settings\n+\n+        s = Settings()\n+        assert s.cors_origins_list == [\"http://a\", \"http://b\"]\n+\n+    def test_should_return_single_origin_when_no_comma(\n</code_context>\n<issue_to_address>\n**suggestion (testing):** Add edge-case tests for empty and malformed CORS_ORIGINS values\n\nConsider adding tests for edge cases like an empty string (`CORS_ORIGINS=\"\"`) or a trailing comma (`\"http://a,\"`). These currently yield `['']` or `['http://a', '']`, and tests would either confirm that this behavior is intended or surface the need to filter out empty values.\n\n```suggestion\n    def test_should_strip_whitespace_when_cors_origins_have_spaces(\n        self, monkeypatch: pytest.MonkeyPatch\n    ) -> None:\n        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n        monkeypatch.setenv(\"CORS_ORIGINS\", \"http://a , http://b\")\n\n        from app.config import Settings\n\n        s = Settings()\n        assert s.cors_origins_list == [\"http://a\", \"http://b\"]\n\n    def test_should_allow_empty_string_cors_origins(\n        self, monkeypatch: pytest.MonkeyPatch\n    ) -> None:\n        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n        monkeypatch.setenv(\"CORS_ORIGINS\", \"\")\n\n        from app.config import Settings\n\n        s = Settings()\n        assert s.cors_origins_list == [\"\"]\n\n    def test_should_preserve_empty_entry_when_trailing_comma_in_cors_origins(\n        self, monkeypatch: pytest.MonkeyPatch\n    ) -> None:\n        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n        monkeypatch.setenv(\"CORS_ORIGINS\", \"http://a,\")\n\n        from app.config import Settings\n\n        s = Settings()\n        assert s.cors_origins_list == [\"http://a\", \"\"]\n\n    def test_should_return_single_origin_when_no_comma(\n```\n</issue_to_address>\n\n### Comment 3\n<location path=\"backend/tests/unit/test_health.py\" line_range=\"34-43\" />\n<code_context>\n+    assert response.status_code == 200\n+\n+\n+async def test_should_include_cors_headers_when_allowed_origin_sent(\n+    client: httpx.AsyncClient,\n+) -> None:\n+    response = await client.options(\n+        \"/api/v1/health\",\n+        headers={\n+            \"Origin\": \"http://localhost:3000\",\n+            \"Access-Control-Request-Method\": \"GET\",\n+        },\n+    )\n+\n+    assert response.headers.get(\"access-control-allow-origin\") == \"http://localhost:3000\"\n+    assert response.headers.get(\"access-control-allow-credentials\") == \"true\"\n</code_context>\n<issue_to_address>\n**suggestion (testing):** Strengthen CORS tests with status code assertion and a negative-origin case\n\nPlease also add a test where the `Origin` is not in `settings.cors_origins_list` and assert that `access-control-allow-origin` is absent (or otherwise behaves as intended). That will cover both allowed and disallowed CORS paths and make the behavior clearer.\n</issue_to_address>\n~~~\n\n</details>\n\n***\n\n<details>\n<summary>Sourcery is free for open source - if you like our reviews please consider sharing them ‚ú®</summary>\n\n- [X](https://twitter.com/intent/tweet?text=I%20just%20got%20an%20instant%20code%20review%20from%20%40SourceryAI%2C%20and%20it%20was%20brilliant%21%20It%27s%20free%20for%20open%20source%20and%20has%20a%20free%20trial%20for%20private%20code.%20Check%20it%20out%20https%3A//sourcery.ai)\n- [Mastodon](https://mastodon.social/share?text=I%20just%20got%20an%20instant%20code%20review%20from%20%40SourceryAI%2C%20and%20it%20was%20brilliant%21%20It%27s%20free%20for%20open%20source%20and%20has%20a%20free%20trial%20for%20private%20code.%20Check%20it%20out%20https%3A//sourcery.ai)\n- [LinkedIn](https://www.linkedin.com/sharing/share-offsite/?url=https://sourcery.ai)\n- [Facebook](https://www.facebook.com/sharer/sharer.php?u=https://sourcery.ai)\n\n</details>\n\n<sub>\nHelp me be more useful! Please click üëç or üëé on each comment and I'll use the feedback to improve your reviews.\n</sub>",
  "verdict": "COMMENT_ONLY",
  "tests_checklist": [],
  "code_quality_checklist": [],
  "security_checklist": [],
  "architecture_checklist": [],
  "dry_yagni_checklist": [],
  "fail_fast_checklist": [],
  "defensive_checklist": [],
  "security_findings": [],
  "architecture_findings": [],
  "issues_found": [],
  "suggested_improvements": [],
  "next_steps": [],
  "reviewer": "sourcery-ai[bot]",
  "date": "2026-02-27T10:36:53Z",
  "commit_reference": "3866210434",
  "review_type": "external",
  "sequence_number": 1,
  "external_feedback": "Hey - I've found 3 issues, and left some high level feedback:\n\n- In `Settings.cors_origins_list`, consider filtering out empty strings after `split(',')` so that accidental trailing commas or an empty `CORS_ORIGINS` value don‚Äôt result in `\"\"` being passed to `CORSMiddleware.allow_origins`.\n- Both configuration and database modules instantiate global objects (`settings`, `async_engine`, `AsyncSessionLocal`) at import time; you might consider a factory or dependency-injected pattern so that startup failures and environment differences (e.g., between local, test, and prod) are easier to control and override.\n\n<details>\n<summary>Prompt for AI Agents</summary>\n\n~~~markdown\nPlease address the comments from this code review:\n\n## Overall Comments\n- In `Settings.cors_origins_list`, consider filtering out empty strings after `split(',')` so that accidental trailing commas or an empty `CORS_ORIGINS` value don‚Äôt result in `\"\"` being passed to `CORSMiddleware.allow_origins`.\n- Both configuration and database modules instantiate global objects (`settings`, `async_engine`, `AsyncSessionLocal`) at import time; you might consider a factory or dependency-injected pattern so that startup failures and environment differences (e.g., between local, test, and prod) are easier to control and override.\n\n## Individual Comments\n\n### Comment 1\n<location path=\"backend/app/config.py\" line_range=\"20-23\" />\n<code_context>\n+    GITHUB_TOKEN: str | None = None\n+    LOG_LEVEL: str = \"INFO\"\n+\n+    @property\n+    def cors_origins_list(self) -> list[str]:\n+        \"\"\"Split comma-separated CORS_ORIGINS into a list.\"\"\"\n+        return [origin.strip() for origin in self.CORS_ORIGINS.split(\",\")]\n+\n+\n</code_context>\n<issue_to_address>\n**suggestion (bug_risk):** Filter out empty CORS origins when building the list.\n\nIf `CORS_ORIGINS` is empty or has trailing commas (e.g. `\"http://a.com,http://b.com,\"`), this will produce empty-string entries, so FastAPI/Starlette will treat `\"\"` as an allowed origin. To avoid that, filter out empty values, e.g. `return [o for o in (origin.strip() for origin in self.CORS_ORIGINS.split(',')) if o]`.\n\n```suggestion\n    @property\n    def cors_origins_list(self) -> list[str]:\n        \"\"\"Split comma-separated CORS_ORIGINS into a list.\"\"\"\n        return [\n            origin\n            for origin in (o.strip() for o in self.CORS_ORIGINS.split(\",\"))\n            if origin\n        ]\n```\n</issue_to_address>\n\n### Comment 2\n<location path=\"backend/tests/unit/test_config.py\" line_range=\"49-60\" />\n<code_context>\n+        with pytest.raises(ValidationError, match=\"JWT_SECRET\"):\n+            Settings()\n+\n+    def test_should_split_origins_when_comma_separated(\n+        self, monkeypatch: pytest.MonkeyPatch\n+    ) -> None:\n+        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n+        monkeypatch.setenv(\"CORS_ORIGINS\", \"http://localhost:3000,http://localhost:3001\")\n+\n+        from app.config import Settings\n+\n+        s = Settings()\n+        assert s.cors_origins_list == [\"http://localhost:3000\", \"http://localhost:3001\"]\n+\n+    def test_should_strip_whitespace_when_cors_origins_have_spaces(\n+        self, monkeypatch: pytest.MonkeyPatch\n+    ) -> None:\n+        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n+        monkeypatch.setenv(\"CORS_ORIGINS\", \"http://a , http://b\")\n+\n+        from app.config import Settings\n+\n+        s = Settings()\n+        assert s.cors_origins_list == [\"http://a\", \"http://b\"]\n+\n+    def test_should_return_single_origin_when_no_comma(\n</code_context>\n<issue_to_address>\n**suggestion (testing):** Add edge-case tests for empty and malformed CORS_ORIGINS values\n\nConsider adding tests for edge cases like an empty string (`CORS_ORIGINS=\"\"`) or a trailing comma (`\"http://a,\"`). These currently yield `['']` or `['http://a', '']`, and tests would either confirm that this behavior is intended or surface the need to filter out empty values.\n\n```suggestion\n    def test_should_strip_whitespace_when_cors_origins_have_spaces(\n        self, monkeypatch: pytest.MonkeyPatch\n    ) -> None:\n        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n        monkeypatch.setenv(\"CORS_ORIGINS\", \"http://a , http://b\")\n\n        from app.config import Settings\n\n        s = Settings()\n        assert s.cors_origins_list == [\"http://a\", \"http://b\"]\n\n    def test_should_allow_empty_string_cors_origins(\n        self, monkeypatch: pytest.MonkeyPatch\n    ) -> None:\n        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n        monkeypatch.setenv(\"CORS_ORIGINS\", \"\")\n\n        from app.config import Settings\n\n        s = Settings()\n        assert s.cors_origins_list == [\"\"]\n\n    def test_should_preserve_empty_entry_when_trailing_comma_in_cors_origins(\n        self, monkeypatch: pytest.MonkeyPatch\n    ) -> None:\n        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n        monkeypatch.setenv(\"CORS_ORIGINS\", \"http://a,\")\n\n        from app.config import Settings\n\n        s = Settings()\n        assert s.cors_origins_list == [\"http://a\", \"\"]\n\n    def test_should_return_single_origin_when_no_comma(\n```\n</issue_to_address>\n\n### Comment 3\n<location path=\"backend/tests/unit/test_health.py\" line_range=\"34-43\" />\n<code_context>\n+    assert response.status_code == 200\n+\n+\n+async def test_should_include_cors_headers_when_allowed_origin_sent(\n+    client: httpx.AsyncClient,\n+) -> None:\n+    response = await client.options(\n+        \"/api/v1/health\",\n+        headers={\n+            \"Origin\": \"http://localhost:3000\",\n+            \"Access-Control-Request-Method\": \"GET\",\n+        },\n+    )\n+\n+    assert response.headers.get(\"access-control-allow-origin\") == \"http://localhost:3000\"\n+    assert response.headers.get(\"access-control-allow-credentials\") == \"true\"\n</code_context>\n<issue_to_address>\n**suggestion (testing):** Strengthen CORS tests with status code assertion and a negative-origin case\n\nPlease also add a test where the `Origin` is not in `settings.cors_origins_list` and assert that `access-control-allow-origin` is absent (or otherwise behaves as intended). That will cover both allowed and disallowed CORS paths and make the behavior clearer.\n</issue_to_address>\n~~~\n\n</details>\n\n***\n\n<details>\n<summary>Sourcery is free for open source - if you like our reviews please consider sharing them ‚ú®</summary>\n\n- [X](https://twitter.com/intent/tweet?text=I%20just%20got%20an%20instant%20code%20review%20from%20%40SourceryAI%2C%20and%20it%20was%20brilliant%21%20It%27s%20free%20for%20open%20source%20and%20has%20a%20free%20trial%20for%20private%20code.%20Check%20it%20out%20https%3A//sourcery.ai)\n- [Mastodon](https://mastodon.social/share?text=I%20just%20got%20an%20instant%20code%20review%20from%20%40SourceryAI%2C%20and%20it%20was%20brilliant%21%20It%27s%20free%20for%20open%20source%20and%20has%20a%20free%20trial%20for%20private%20code.%20Check%20it%20out%20https%3A//sourcery.ai)\n- [LinkedIn](https://www.linkedin.com/sharing/share-offsite/?url=https://sourcery.ai)\n- [Facebook](https://www.facebook.com/sharer/sharer.php?u=https://sourcery.ai)\n\n</details>\n\n<sub>\nHelp me be more useful! Please click üëç or üëé on each comment and I'll use the feedback to improve your reviews.\n</sub>\n\n## Inline Comments\n- `backend/app/config.py:23` ‚Äî \"**suggestion (bug_risk):** Filter out empty CORS origins when building the list.\n\nIf `CORS_ORIGINS` is empty or has trailing commas (e.g. `\"http://a.com,http://b.com,\"`), this will produce empty-string entries, so FastAPI/Starlette will treat `\"\"` as an allowed origin. To avoid that, filter out empty values, e.g. `return [o for o in (origin.strip() for origin in self.CORS_ORIGINS.split(',')) if o]`.\n\n```suggestion\n    @property\n    def cors_origins_list(self) -> list[str]:\n        \"\"\"Split comma-separated CORS_ORIGINS into a list.\"\"\"\n        return [\n            origin\n            for origin in (o.strip() for o in self.CORS_ORIGINS.split(\",\"))\n            if origin\n        ]\n```\"\n- `backend/tests/unit/test_config.py:60` ‚Äî \"**suggestion (testing):** Add edge-case tests for empty and malformed CORS_ORIGINS values\n\nConsider adding tests for edge cases like an empty string (`CORS_ORIGINS=\"\"`) or a trailing comma (`\"http://a,\"`). These currently yield `['']` or `['http://a', '']`, and tests would either confirm that this behavior is intended or surface the need to filter out empty values.\n\n```suggestion\n    def test_should_strip_whitespace_when_cors_origins_have_spaces(\n        self, monkeypatch: pytest.MonkeyPatch\n    ) -> None:\n        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n        monkeypatch.setenv(\"CORS_ORIGINS\", \"http://a , http://b\")\n\n        from app.config import Settings\n\n        s = Settings()\n        assert s.cors_origins_list == [\"http://a\", \"http://b\"]\n\n    def test_should_allow_empty_string_cors_origins(\n        self, monkeypatch: pytest.MonkeyPatch\n    ) -> None:\n        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n        monkeypatch.setenv(\"CORS_ORIGINS\", \"\")\n\n        from app.config import Settings\n\n        s = Settings()\n        assert s.cors_origins_list == [\"\"]\n\n    def test_should_preserve_empty_entry_when_trailing_comma_in_cors_origins(\n        self, monkeypatch: pytest.MonkeyPatch\n    ) -> None:\n        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n        monkeypatch.setenv(\"CORS_ORIGINS\", \"http://a,\")\n\n        from app.config import Settings\n\n        s = Settings()\n        assert s.cors_origins_list == [\"http://a\", \"\"]\n\n    def test_should_return_single_origin_when_no_comma(\n```\"\n- `backend/tests/unit/test_health.py:43` ‚Äî \"**suggestion (testing):** Strengthen CORS tests with status code assertion and a negative-origin case\n\nPlease also add a test where the `Origin` is not in `settings.cors_origins_list` and assert that `access-control-allow-origin` is absent (or otherwise behaves as intended). That will cover both allowed and disallowed CORS paths and make the behavior clearer.\"",
  "code_comments": [
    {
      "body": "**suggestion (bug_risk):** Filter out empty CORS origins when building the list.\n\nIf `CORS_ORIGINS` is empty or has trailing commas (e.g. `\"http://a.com,http://b.com,\"`), this will produce empty-string entries, so FastAPI/Starlette will treat `\"\"` as an allowed origin. To avoid that, filter out empty values, e.g. `return [o for o in (origin.strip() for origin in self.CORS_ORIGINS.split(',')) if o]`.\n\n```suggestion\n    @property\n    def cors_origins_list(self) -> list[str]:\n        \"\"\"Split comma-separated CORS_ORIGINS into a list.\"\"\"\n        return [\n            origin\n            for origin in (o.strip() for o in self.CORS_ORIGINS.split(\",\"))\n            if origin\n        ]\n```",
      "path": "backend/app/config.py",
      "line": 23,
      "author": "sourcery-ai[bot]",
      "created_at": "2026-02-27T10:36:53Z"
    },
    {
      "body": "**suggestion (testing):** Add edge-case tests for empty and malformed CORS_ORIGINS values\n\nConsider adding tests for edge cases like an empty string (`CORS_ORIGINS=\"\"`) or a trailing comma (`\"http://a,\"`). These currently yield `['']` or `['http://a', '']`, and tests would either confirm that this behavior is intended or surface the need to filter out empty values.\n\n```suggestion\n    def test_should_strip_whitespace_when_cors_origins_have_spaces(\n        self, monkeypatch: pytest.MonkeyPatch\n    ) -> None:\n        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n        monkeypatch.setenv(\"CORS_ORIGINS\", \"http://a , http://b\")\n\n        from app.config import Settings\n\n        s = Settings()\n        assert s.cors_origins_list == [\"http://a\", \"http://b\"]\n\n    def test_should_allow_empty_string_cors_origins(\n        self, monkeypatch: pytest.MonkeyPatch\n    ) -> None:\n        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n        monkeypatch.setenv(\"CORS_ORIGINS\", \"\")\n\n        from app.config import Settings\n\n        s = Settings()\n        assert s.cors_origins_list == [\"\"]\n\n    def test_should_preserve_empty_entry_when_trailing_comma_in_cors_origins(\n        self, monkeypatch: pytest.MonkeyPatch\n    ) -> None:\n        monkeypatch.setenv(\"JWT_SECRET\", \"test-secret\")\n        monkeypatch.setenv(\"CORS_ORIGINS\", \"http://a,\")\n\n        from app.config import Settings\n\n        s = Settings()\n        assert s.cors_origins_list == [\"http://a\", \"\"]\n\n    def test_should_return_single_origin_when_no_comma(\n```",
      "path": "backend/tests/unit/test_config.py",
      "line": 60,
      "author": "sourcery-ai[bot]",
      "created_at": "2026-02-27T10:36:53Z"
    },
    {
      "body": "**suggestion (testing):** Strengthen CORS tests with status code assertion and a negative-origin case\n\nPlease also add a test where the `Origin` is not in `settings.cors_origins_list` and assert that `access-control-allow-origin` is absent (or otherwise behaves as intended). That will cover both allowed and disallowed CORS paths and make the behavior clearer.",
      "path": "backend/tests/unit/test_health.py",
      "line": 43,
      "author": "sourcery-ai[bot]",
      "created_at": "2026-02-27T10:36:53Z"
    }
  ],
  "resolved": true
}